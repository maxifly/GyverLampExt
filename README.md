# GyverLamp для Home Assistant

[![hacs_badge](https://img.shields.io/badge/HACS-Custom-orange.svg)](https://github.com/custom-components/hacs)

Компонент интеграции [Home Assistant][1] с [Огненной Wi-Fi Лампой][2] замечательного российского изобретателя [Александра Майорова][3]. Обязательно **не забывам поддержать** автора этого изобретения.

[1]: https://www.home-assistant.io/
[2]: https://alexgyver.ru/gyverlamp/
[3]: https://alexgyver.ru/about_gyver/

Компонент работает со стандартной прошивкой лампы. Текущее состояние лампы **опрашивается раз в 30 секунд**, поэтому, после старта Home Assistant, она будет пол минуты выключена.
Для работы с прошивкой от [gunner47](https://community.alexgyver.ru/threads/wifi-lampa-budilnik-obsuzhdenie-proshivki-ot-gunner47.2418/page-72#post-33652)
необходимо буте в настройках поменять список эффектов или ввести только понравившиеся эффекты, указав их названия и индексы

Поддерживается:

- включение/выключение лампы
- установка яркости
- установка эффекта из списка
- включение случайного элемента из списка в момент включения лампы
- использование только части эффектов прошитых в контроллере лампы
- установка скорости и масштаба через тон и насыщенность (круг с набором цветов в интерфейсе HA)
   - **насыщенность** это **скорость**, ближе к центру - быстрее 
   - **цвет** это **масштаб**, но в некоторых эффектах цвет это цвет :) 

Компонент создан на основе форка проекта https://github.com/AlexxIT/GyverLamp


![](screen.png)

## Установка

**Способ 1.** [HACS](https://hacs.xyz/)

> HACS > Интеграции > 3 точки (правый верхний угол) > Пользовательские репозитории > URL: `maxifly/GyverLampExt`, Категория: Интеграция > Добавить > подождать > GyverLampExt > Установить

**Способ 2.** Вручную скопируйте папку `gyverlampext` из [latest release](https://github.com/maxifly/GyverLampExt/releases/latest) в директорию `/config/custom_components`.

## Настройка

**Способ 1.** GUI

> Настройки > Интеграции > Добавить интеграцию > **GyverLampExt**

Если интеграции нет в списке - очистите кэш браузера.

**Способ 2.** YAML

```yaml
light:
- platform: gyverlampext
  host: 192.168.1.123
  name: Gyver lamp test
  use_random_effect: true
  include_all_effect_to_random: true
  effects:
  - Конфетти
  - Огонь
  - ...
  effects_map:
   - name: Волна
     id: 4
     favorite: true
   - name: Облака
     id: 16
     favorite: false
   - ...
 
```

| Параметр                     | Обязательный | Значение по умолчанию | Назначение                                                                                                                                                                                                  |
|------------------------------|:------------:|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| host                         |      да      |                       | Адрес лампы в локальной сети                                                                                                                                                                                |
| name                         |      -       |                       | Название лампы                                                                                                                                                                                              |
| use_random_effect            |      -       | false                 | При включении лампы включается случайный эффект                                                                                                                                                             |
| include_all_effect_to_random |      -       | false                 | Все эффекты из списка effects включаются в список случайного выюора эффекта при включении                                                                                                                   |
| effects                      |      -       |                       | Список эффектов по порядку.    <br/> Названия произвольные, как Вам нравится. Первому элементу из списка присваивается индекс 0, второму 1 и т.д. При выборе эффекта именно эти индексы посылаются на лампу |
| effects_map                  |      -       |                       | Позволяет задать список элементов не в порядке следования их индексов и позволяет перечислить не все элементы, доступные на лампе                                                                           |
| name                         |      да      |                       | Имя эффекта                                                                                                                                                                                                 |
| id                           |      да      |                       | Идентификатор эффекта                                                                                                                                                                                       |
| random                       |      -       | false                 | Эффект включается в список случайного выбора                                                                                                                                                                |

Списки effects и effects_map дополняют друг друга
